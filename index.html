<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.9">
    
    
      
        <title>&#129535;: `safer`: A safer writer for files and streams &#129535;</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#safer-a-safer-writer-for-files-and-streams" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="&#129535;: `safer`: A safer writer for files and streams &#129535;" class="md-header__button md-logo" aria-label="&#129535;: `safer`: A safer writer for files and streams &#129535;" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            &#129535;: `safer`: A safer writer for files and streams &#129535;
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              &#129535; `safer`: A safer writer for files and streams
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="&#129535;: `safer`: A safer writer for files and streams &#129535;" class="md-nav__button md-logo" aria-label="&#129535;: `safer`: A safer writer for files and streams &#129535;" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>

    </a>
    &#129535;: `safer`: A safer writer for files and streams &#129535;
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          &#129535; `safer`: A safer writer for files and streams
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#safer" class="md-nav__link">
    safer
  </a>
  
    <nav class="md-nav" aria-label="safer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safer--quick-summary" class="md-nav__link">
    Quick summary
  </a>
  
    <nav class="md-nav" aria-label="Quick summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safer--a-tiny-example" class="md-nav__link">
    A tiny example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safer--how-to-use" class="md-nav__link">
    How to use
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safer--the-details" class="md-nav__link">
    The details
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safer--example-saferwriter" class="md-nav__link">
    Example: safer.writer()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safer--example-saferopen-and-json" class="md-nav__link">
    Example: safer.open() and json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safer--example-saferprinter" class="md-nav__link">
    Example: safer.printer()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safer.closer" class="md-nav__link">
    closer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safer.dump" class="md-nav__link">
    dump()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safer.open" class="md-nav__link">
    open()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safer.printer" class="md-nav__link">
    printer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safer.writer" class="md-nav__link">
    writer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-this-project" class="md-nav__link">
    About this project
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#safer" class="md-nav__link">
    safer
  </a>
  
    <nav class="md-nav" aria-label="safer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safer--quick-summary" class="md-nav__link">
    Quick summary
  </a>
  
    <nav class="md-nav" aria-label="Quick summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#safer--a-tiny-example" class="md-nav__link">
    A tiny example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safer--how-to-use" class="md-nav__link">
    How to use
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safer--the-details" class="md-nav__link">
    The details
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safer--example-saferwriter" class="md-nav__link">
    Example: safer.writer()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safer--example-saferopen-and-json" class="md-nav__link">
    Example: safer.open() and json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safer--example-saferprinter" class="md-nav__link">
    Example: safer.printer()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safer.closer" class="md-nav__link">
    closer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safer.dump" class="md-nav__link">
    dump()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safer.open" class="md-nav__link">
    open()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safer.printer" class="md-nav__link">
    printer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safer.writer" class="md-nav__link">
    writer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-this-project" class="md-nav__link">
    About this project
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div class="doc doc-object doc-module">


<a id="safer"></a>
  <div class="doc doc-contents first">
  
      <p>Avoid partial writes or corruption!</p>
<p><code>safer</code> wraps file streams, sockets, or a callable, and offers a drop-in
replacement for regular old <code>open()</code>.</p>
<h3 id="safer--quick-summary">Quick summary</h3>
<h4 id="safer--a-tiny-example">A tiny example</h4>
<pre><code>import safer

with safer.open(filename, 'w') as fp:
    fp.write('one')
    print('two', file=fp)
    raise ValueError
    # filename was not written.
</code></pre>
<h4 id="safer--how-to-use">How to use</h4>
<p>Use <a href="https://pypi.org/project/pip">pip</a> to install <code>safer</code> from the command
line: <code>pip install safer</code>.</p>
<p>Tested on Python 3.4 - 3.11.  An old Python 2.7 version
is <a href="https://github.com/rec/safer/tree/v2.0.5">here</a>.</p>
<p>See the Medium article <a href="https://medium.com/@TomSwirly/%EF%B8%8F-safer-a-safer-file-writer-%EF%B8%8F-5fe267dbe3f5">here</a></p>
<h4 id="safer--the-details">The details</h4>
<p><code>safer</code> helps prevent programmer error from corrupting files, socket
connections, or generalized streams by writing a whole file or nothing.</p>
<p>It does not prevent concurrent modification of files from other threads or
processes: if you need atomic file writing, see
https://pypi.org/project/atomicwrites/</p>
<p>It also has a useful <code>dry_run</code> setting to let you test your code without
actually overwriting the target file.</p>
<ul>
<li>
<p><code>safer.writer()</code> wraps an existing writer, socket or stream and writes a
  whole response or nothing</p>
</li>
<li>
<p><code>safer.open()</code> is a drop-in replacement for built-in <code>open</code> that
  writes a whole file or nothing</p>
</li>
<li>
<p><code>safer.closer()</code> returns a stream like from <code>safer.write()</code> that also
  closes the underlying stream or callable when it closes.</p>
</li>
<li>
<p><code>safer.dump()</code> is like a safer <code>json.dump()</code> which can be used for any
  serialization protocol, including Yaml and Toml, and also allows you to
  write to file streams or any other callable.</p>
</li>
<li>
<p><code>safer.printer()</code> is <code>safer.open()</code> except that it yields a
  a function that prints to the stream.</p>
</li>
</ul>
<p>By default, <code>safer</code> buffers the written data in memory in a <code>io.StringIO</code>
or <code>io.BytesIO</code>.</p>
<p>For very large files, <code>safer.open()</code> has a <code>temp_file</code> argument which
writes the data to a temporary file on disk, which is moved over using
<code>os.rename</code> if the operation completes successfully.  This functionality
does not work on Windows.  (In fact, it's unclear if any of this works on
Windows, but that certainly won't.  Windows developer solicted!)</p>
<h4 id="safer--example-saferwriter">Example: <code>safer.writer()</code>
</h4>
<p><code>safer.writer()</code> wraps an existing stream - a writer, socket, or callback -
in a temporary stream which is only copied to the target stream at close(), and
only if no exception was raised.</p>
<p>Suppose <code>sock = socket.socket(*args)</code>.</p>
<p>The old, dangerous way goes like this.</p>
<pre><code>try:
    write_header(sock)
    write_body(sock)   # Exception is thrown here
    write_footer(sock)
 except Exception:
    write_error(sock)  # Oops, the header was already written
</code></pre>
<p>With <code>safer</code> you write all or nothing:</p>
<pre><code>try:
    with safer.writer(sock) as s:
        write_header(s)
        write_body(s)  # Exception is thrown here
        write_footer(s)
 except Exception:
    write_error(sock)  # Nothing has been written
</code></pre>
<h4 id="safer--example-saferopen-and-json">Example: <code>safer.open()</code> and json</h4>
<p><code>safer.open()</code> is a a drop-in replacement for built-in <code>open()</code> except that when
used as a context, it leaves the original file unchanged on failure.</p>
<p>It's easy to write broken JSON if something within it doesn't serialize.</p>
<pre><code>with open(filename, 'w') as fp:
    json.dump(data, fp)
    # If an exception is raised, the file is empty or partly written
</code></pre>
<p><code>safer</code> prevents this:</p>
<pre><code>with safer.open(filename, 'w') as fp:
    json.dump(data, fp)
    # If an exception is raised, the file is unchanged.
</code></pre>
<p><code>safer.open(filename)</code> returns a file stream <code>fp</code> like <code>open(filename)</code>
would, except that <code>fp</code> writes to memory stream or a temporary file in the
same directory.</p>
<p>If <code>fp</code> is used as a context manager and an exception is raised, then the
property <code>fp.safer_failed</code> on the stream is automatically set to <code>True</code>.</p>
<p>And when <code>fp.close()</code> is called, the cached data is stored in <code>filename</code> -
<em>unless</em> <code>fp.safer_failed</code> is true.</p>
<h4 id="safer--example-saferprinter">Example: <code>safer.printer()</code>
</h4>
<p><code>safer.printer()</code> is similar to <code>safer.open()</code> except it yields a function
that prints to the open file - it's very convenient for printing text.</p>
<p>Like <code>safer.open()</code>, if an exception is raised within its context manager,
the original file is left unchanged.</p>
<p>Before.</p>
<pre><code>with open(file, 'w') as fp:
    for item in items:
        print(item, file=fp)
    # Prints lines until the first exception
</code></pre>
<p>With <code>safer</code></p>
<pre><code>with safer.printer(file) as print:
    for item in items:
        print(item)
    # Either the whole file is written, or nothing
</code></pre>

  

  <hr>
<p></p>
<h1 id="safer--api-documentation">API Documentation</h1>
<div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="safer.closer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">closer</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">is_binary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">close_on_exit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Like <code>safer.writer()</code> but with <code>close_on_exit=True</code> by default</p>
<p>ARGUMENTS
  Same as for <code>safer.writer()</code></p>

      <details class="quote">
        <summary>Source code in <code>safer/safer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr>
<td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td>
<td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">closer</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">is_binary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">close_on_exit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Like `safer.writer()` but with `close_on_exit=True` by default</span>

<span class="sd">    ARGUMENTS</span>
<span class="sd">      Same as for `safer.writer()`</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">writer</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">is_binary</span><span class="p">,</span> <span class="n">close_on_exit</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
</code></pre></div></td>
</tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="safer.dump" class="doc doc-heading">
<code class="highlight language-python"><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dump</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Safely serialize <code>obj</code> as a formatted stream to <code>fp`` (a</code>.write()<code>-supporting file-like object, or a filename),
using</code>json.dump` by default</p>
<p>ARGUMENTS
  obj:
    The object to be serialized</p>
<p>stream:
    A file stream, a socket, or a callable that will receive data.
    If stream is <code>None</code>, output is written to <code>sys.stdout</code>.
    If stream is a string or <code>Path</code>, the file with that name is opened for
    writing.</p>
<p>dump:
    A function or module or the name of a function or module to dump data.
    If <code>None</code>, default to `json.dump``.</p>
<p>kwargs:
    Additional arguments to <code>dump</code>.</p>

      <details class="quote">
        <summary>Source code in <code>safer/safer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr>
<td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span></pre></div></td>
<td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dump</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Safely serialize `obj` as a formatted stream to `fp`` (a</span>
<span class="sd">    `.write()`-supporting file-like object, or a filename),</span>
<span class="sd">    using `json.dump` by default</span>

<span class="sd">    ARGUMENTS</span>
<span class="sd">      obj:</span>
<span class="sd">        The object to be serialized</span>

<span class="sd">      stream:</span>
<span class="sd">        A file stream, a socket, or a callable that will receive data.</span>
<span class="sd">        If stream is `None`, output is written to `sys.stdout`.</span>
<span class="sd">        If stream is a string or `Path`, the file with that name is opened for</span>
<span class="sd">        writing.</span>

<span class="sd">      dump:</span>
<span class="sd">        A function or module or the name of a function or module to dump data.</span>
<span class="sd">        If `None`, default to `json.dump``.</span>

<span class="sd">      kwargs:</span>
<span class="sd">        Additional arguments to `dump`.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">stream</span>
        <span class="n">is_binary</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">'mode'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">mode</span><span class="p">:</span>
            <span class="n">is_binary</span> <span class="o">=</span> <span class="s1">'b'</span> <span class="ow">in</span> <span class="n">mode</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_binary</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">'recv'</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">'send'</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dump</span><span class="p">:</span>
        <span class="n">dump</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dump</span> <span class="o">==</span> <span class="s1">'yml'</span><span class="p">:</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="s1">'yaml'</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dump</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">dump</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">'.'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dump</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="n">mod</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">dump</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="n">mod</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dump</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dump</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dump</span>

    <span class="k">elif</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">dump</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="n">dump</span><span class="o">.</span><span class="n">safe_dump</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="n">dump</span><span class="o">.</span><span class="n">dump</span>

    <span class="k">with</span> <span class="n">writer</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_binary</span><span class="p">:</span>
            <span class="n">write</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">write</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
</code></pre></div></td>
</tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="safer.open" class="doc doc-heading">
<code class="highlight language-python"><span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">closefd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">opener</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">make_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">delete_failures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temp_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>make_parents</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If true, create the parent directory of the file if needed</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>delete_failures</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If false, any temporary files created are not deleted
if there is an exception.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>temp_file</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
<p>If <code>temp_file</code> is truthy, write to a disk file and use
  os.rename() at the end, otherwise cache the writes in memory.</p>
<p>If <code>temp_file</code> is a string, use it as the name of the temporary
  file, otherwise select one in the same directory as the target
  file, or in the system tempfile for streams that aren't files.</p>
</td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>dry_run</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If dry_run is True, the file is not written to at all</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>The remaining arguments are the same as for built-in <code>open()</code>.</p>
<p><code>safer.open() is a drop-in replacement for built-in</code>open()`. It returns a
stream which only overwrites the original file when close() is called, and
only if there was no failure.</p>
<p>It works as follows:</p>
<p>If a stream <code>fp</code> return from <code>safer.open()</code> is used as a context
manager and an exception is raised, the property <code>fp.safer_failed</code> is
set to <code>True</code>.</p>
<p>In the method <code>fp.close()</code>, if <code>fp.safer_failed</code> is <em>not</em> set, then the
cached results replace the original file, successfully completing the
write.</p>
<p>If <code>fp.safer_failed</code> is true, then if <code>delete_failures</code> is true, the
temporary file is deleted.</p>
<p>If the <code>mode</code> argument contains either <code>'a'</code> (append), or <code>'+'</code>
(update), then the original file will be copied to the temporary file
before writing starts.</p>
<p>Note that if the <code>temp_file</code> argument is set, <code>safer</code> uses an extra
temporary file which is renamed over the file only after the stream closes
without failing. This uses as much disk space as the old and new files put
together.</p>

      <details class="quote">
        <summary>Source code in <code>safer/safer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr>
<td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span></pre></div></td>
<td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'r'</span><span class="p">,</span>
    <span class="n">buffering</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">newline</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">closefd</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">opener</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">make_parents</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">delete_failures</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">temp_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IO</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Args:</span>
<span class="sd">      make_parents: If true, create the parent directory of the file if needed</span>

<span class="sd">      delete_failures: If false, any temporary files created are not deleted</span>
<span class="sd">        if there is an exception.</span>

<span class="sd">      temp_file: If `temp_file` is truthy, write to a disk file and use</span>
<span class="sd">          os.rename() at the end, otherwise cache the writes in memory.</span>

<span class="sd">          If `temp_file` is a string, use it as the name of the temporary</span>
<span class="sd">          file, otherwise select one in the same directory as the target</span>
<span class="sd">          file, or in the system tempfile for streams that aren't files.</span>

<span class="sd">      dry_run:</span>
<span class="sd">         If dry_run is True, the file is not written to at all</span>

<span class="sd">    The remaining arguments are the same as for built-in `open()`.</span>

<span class="sd">    `safer.open() is a drop-in replacement for built-in`open()`. It returns a</span>
<span class="sd">    stream which only overwrites the original file when close() is called, and</span>
<span class="sd">    only if there was no failure.</span>

<span class="sd">    It works as follows:</span>

<span class="sd">    If a stream `fp` return from `safer.open()` is used as a context</span>
<span class="sd">    manager and an exception is raised, the property `fp.safer_failed` is</span>
<span class="sd">    set to `True`.</span>

<span class="sd">    In the method `fp.close()`, if `fp.safer_failed` is *not* set, then the</span>
<span class="sd">    cached results replace the original file, successfully completing the</span>
<span class="sd">    write.</span>

<span class="sd">    If `fp.safer_failed` is true, then if `delete_failures` is true, the</span>
<span class="sd">    temporary file is deleted.</span>

<span class="sd">    If the `mode` argument contains either `'a'` (append), or `'+'`</span>
<span class="sd">    (update), then the original file will be copied to the temporary file</span>
<span class="sd">    before writing starts.</span>

<span class="sd">    Note that if the `temp_file` argument is set, `safer` uses an extra</span>
<span class="sd">    temporary file which is renamed over the file only after the stream closes</span>
<span class="sd">    without failing. This uses as much disk space as the old and new files put</span>
<span class="sd">    together.</span>
<span class="sd">    """</span>
    <span class="n">is_copy</span> <span class="o">=</span> <span class="s1">'+'</span> <span class="ow">in</span> <span class="n">mode</span> <span class="ow">or</span> <span class="s1">'a'</span> <span class="ow">in</span> <span class="n">mode</span>
    <span class="n">is_read</span> <span class="o">=</span> <span class="s1">'r'</span> <span class="ow">in</span> <span class="n">mode</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_copy</span>
    <span class="n">is_binary</span> <span class="o">=</span> <span class="s1">'b'</span> <span class="ow">in</span> <span class="n">mode</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">,</span> <span class="n">opener</span><span class="o">=</span><span class="n">opener</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'`name` must be string, not </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">make_parents</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">'Directory does not exist'</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">simple_open</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">__builtins__</span><span class="p">[</span><span class="s1">'open'</span><span class="p">](</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">buffering</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">simple_write</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">simple_open</span><span class="p">()</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_read</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">simple_open</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">temp_file</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">'+'</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'+ mode requires a temp_file argument'</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">dry_run</span><span class="p">):</span>
            <span class="n">write</span> <span class="o">=</span> <span class="n">dry_run</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">write</span> <span class="o">=</span> <span class="nb">len</span> <span class="k">if</span> <span class="n">dry_run</span> <span class="k">else</span> <span class="n">simple_write</span>

        <span class="n">fp</span> <span class="o">=</span> <span class="n">_MemoryStreamCloser</span><span class="p">(</span><span class="n">write</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">is_binary</span><span class="p">)</span><span class="o">.</span><span class="n">fp</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="k">return</span> <span class="n">fp</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">closefd</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Cannot use closefd=False with file name'</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_binary</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">'t'</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'can</span><span class="se">\'</span><span class="s1">t have text and binary mode at once'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newline</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'binary mode doesn</span><span class="se">\'</span><span class="s1">t take a newline argument'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'binary mode doesn</span><span class="se">\'</span><span class="s1">t take an encoding argument'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'binary mode doesn</span><span class="se">\'</span><span class="s1">t take an errors argument'</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">'x'</span> <span class="ow">in</span> <span class="n">mode</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">"File exists: '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">buffering</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">buffering</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">DEFAULT_BUFFER_SIZE</span>

    <span class="n">closer</span> <span class="o">=</span> <span class="n">_FileRenameCloser</span><span class="p">(</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">temp_file</span><span class="p">,</span> <span class="n">delete_failures</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">dry_run</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">is_copy</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">closer</span><span class="o">.</span><span class="n">temp_file</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">closer</span><span class="o">.</span><span class="n">_make_stream</span><span class="p">(</span><span class="n">buffering</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td>
</tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="safer.printer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">printer</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>A context manager that yields a function that prints to the opened file,
only writing to the original file at the exit of the context,
and only if there was no exception thrown</p>
<p>ARGUMENTS
  Same as for <code>safer.open()</code></p>

      <details class="quote">
        <summary>Source code in <code>safer/safer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr>
<td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span></pre></div></td>
<td class="code"><div><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">printer</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    A context manager that yields a function that prints to the opened file,</span>
<span class="sd">    only writing to the original file at the exit of the context,</span>
<span class="sd">    and only if there was no exception thrown</span>

<span class="sd">    ARGUMENTS</span>
<span class="sd">      Same as for `safer.open()`</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="s1">'r'</span> <span class="ow">in</span> <span class="n">mode</span> <span class="ow">and</span> <span class="s1">'+'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">'File not open for writing'</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">'b'</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Cannot print to a file open in binary mode'</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="nb">print</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
</code></pre></div></td>
</tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="safer.writer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">writer</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_binary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">close_on_exit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">temp_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1048576</span><span class="p">,</span> <span class="n">delete_failures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Write safely to file streams, sockets and callables.</p>
<p><code>safer.writer</code> yields an in-memory stream that you can write
to, but which is only written to the original stream if the
context finishes without raising an exception.</p>
<p>Because the actual writing happens at the end, it's possible to block
indefinitely when the context exits if the underlying socket, stream or
callable does!</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>stream</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.Callable">Callable</span>, None, <span title="typing.IO">IO</span>, <span title="pathlib.Path">Path</span>, str]</code>
          </td>
          <td>
<p>A file stream, a socket, or a callable that will receive data.</p>
<p>If stream is <code>None</code>, output is written to <code>sys.stdout</code></p>
<p>If stream is a string or <code>Path</code>, the file with that name is
  opened for writing.</p>
</td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>is_binary</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[bool]</code>
          </td>
          <td>
<p>Is <code>stream</code> a binary stream?</p>
<p>If <code>is_binary</code> is <code>None</code>, deduce whether it's a binary file from
  the stream, or assume it's text otherwise.</p>
</td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>close_on_exit</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, the underlying stream is closed when the writer
closes</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>temp_file</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
<p>If <code>temp_file</code> is truthy, write to a disk file and use
  os.rename() at the end, otherwise cache the writes in memory.</p>
<p>If <code>temp_file</code> is a string, use it as the name of the temporary
  file, otherwise select one in the same directory as the target
  file, or in the system tempfile for streams that aren't files.</p>
</td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>chunk_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Chunk size, in bytes for transfer data from the temporary
  file to the underlying stream.</p></td>
          <td>
                <code>1048576</code>
          </td>
        </tr>
        <tr>
          <td><code>delete_failures</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If false, any temporary files created are not deleted
if there is an exception.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>dry_run</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[bool, <span title="typing.Callable">Callable</span>]</code>
          </td>
          <td>
<p>If <code>dry_run</code> is truthy, the stream or file is left unchanged.</p>
<p>If <code>dry_run</code> is also callable, the results of the stream are passed to
<code>dry_run()</code> rather than being written to the stream.</p>
</td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>safer/safer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr>
<td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td>
<td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">writer</span><span class="p">(</span>
    <span class="n">stream</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">IO</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">is_binary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">close_on_exit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">temp_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mh">0x100000</span><span class="p">,</span>
    <span class="n">delete_failures</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">IO</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Write safely to file streams, sockets and callables.</span>

<span class="sd">    `safer.writer` yields an in-memory stream that you can write</span>
<span class="sd">    to, but which is only written to the original stream if the</span>
<span class="sd">    context finishes without raising an exception.</span>

<span class="sd">    Because the actual writing happens at the end, it's possible to block</span>
<span class="sd">    indefinitely when the context exits if the underlying socket, stream or</span>
<span class="sd">    callable does!</span>

<span class="sd">    Args:</span>
<span class="sd">      stream: A file stream, a socket, or a callable that will receive data.</span>

<span class="sd">          If stream is `None`, output is written to `sys.stdout`</span>

<span class="sd">          If stream is a string or `Path`, the file with that name is</span>
<span class="sd">          opened for writing.</span>

<span class="sd">      is_binary: Is `stream` a binary stream?</span>

<span class="sd">          If `is_binary` is ``None``, deduce whether it's a binary file from</span>
<span class="sd">          the stream, or assume it's text otherwise.</span>

<span class="sd">      close_on_exit: If True, the underlying stream is closed when the writer</span>
<span class="sd">        closes</span>

<span class="sd">      temp_file: If `temp_file` is truthy, write to a disk file and use</span>
<span class="sd">          os.rename() at the end, otherwise cache the writes in memory.</span>

<span class="sd">          If `temp_file` is a string, use it as the name of the temporary</span>
<span class="sd">          file, otherwise select one in the same directory as the target</span>
<span class="sd">          file, or in the system tempfile for streams that aren't files.</span>

<span class="sd">      chunk_size: Chunk size, in bytes for transfer data from the temporary</span>
<span class="sd">          file to the underlying stream.</span>

<span class="sd">      delete_failures: If false, any temporary files created are not deleted</span>
<span class="sd">        if there is an exception.</span>

<span class="sd">      dry_run: If `dry_run` is truthy, the stream or file is left unchanged.</span>

<span class="sd">        If `dry_run` is also callable, the results of the stream are passed to</span>
<span class="sd">        `dry_run()` rather than being written to the stream.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">'wb'</span> <span class="k">if</span> <span class="n">is_binary</span> <span class="k">else</span> <span class="s1">'w'</span>
        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">stream</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">delete_failures</span><span class="o">=</span><span class="n">delete_failures</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="n">dry_run</span>
        <span class="p">)</span>

    <span class="n">stream</span> <span class="o">=</span> <span class="n">stream</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>

    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">dry_run</span><span class="p">):</span>
        <span class="n">write</span><span class="p">,</span> <span class="n">dry_run</span> <span class="o">=</span> <span class="n">dry_run</span><span class="p">,</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">dry_run</span><span class="p">:</span>
        <span class="n">write</span> <span class="o">=</span> <span class="nb">len</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">write</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">'write'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">send</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">'send'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">'mode'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
        <span class="n">close_on_exit</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">close_on_exit</span> <span class="ow">and</span> <span class="n">stream</span> <span class="ow">in</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'You cannot close stdout or stderr'</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">write</span> <span class="ow">and</span> <span class="n">mode</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="s1">'w+a'</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">mode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Stream mode "</span><span class="si">%s</span><span class="s1">" is not a write mode'</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>

        <span class="n">binary_mode</span> <span class="o">=</span> <span class="s1">'b'</span> <span class="ow">in</span> <span class="n">mode</span>
        <span class="k">if</span> <span class="n">is_binary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">is_binary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">binary_mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'is_binary is inconsistent with the file stream'</span><span class="p">)</span>

        <span class="n">is_binary</span> <span class="o">=</span> <span class="n">binary_mode</span>

    <span class="k">elif</span> <span class="n">dry_run</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">elif</span> <span class="n">send</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">'recv'</span><span class="p">):</span>  <span class="c1"># It looks like a socket:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">is_binary</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">is_binary</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'is_binary=False is inconsistent with a socket'</span><span class="p">)</span>

        <span class="n">write</span> <span class="o">=</span> <span class="n">send</span>
        <span class="n">is_binary</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
        <span class="n">write</span> <span class="o">=</span> <span class="n">stream</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">'Stream is not a file, a socket, or callable'</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">temp_file</span><span class="p">:</span>
        <span class="n">closer</span> <span class="o">=</span> <span class="n">_FileStreamCloser</span><span class="p">(</span>
            <span class="n">write</span><span class="p">,</span>
            <span class="n">close_on_exit</span><span class="p">,</span>
            <span class="n">is_binary</span><span class="p">,</span>
            <span class="n">temp_file</span><span class="p">,</span>
            <span class="n">chunk_size</span><span class="p">,</span>
            <span class="n">delete_failures</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">closer</span> <span class="o">=</span> <span class="n">_MemoryStreamCloser</span><span class="p">(</span><span class="n">write</span><span class="p">,</span> <span class="n">close_on_exit</span><span class="p">,</span> <span class="n">is_binary</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">send</span> <span class="ow">is</span> <span class="n">write</span><span class="p">:</span>
        <span class="n">closer</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">send</span> <span class="o">=</span> <span class="n">write</span>

    <span class="k">return</span> <span class="n">closer</span><span class="o">.</span><span class="n">fp</span>
</code></pre></div></td>
</tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
<h2 id="about-this-project">About this project</h2>
<ul>
<li><a href="https://github.com/rec/safer"> Source code </a></li>
<li><a href="https://github.com/rec"> More by this author </a></li>
<li><a href="https://github.com/sponsors/rec"> Sponsors </a></li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.a00a7c5e.min.js"></script>
      
    
  </body>
</html>
